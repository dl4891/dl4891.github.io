function voti_53_0x3a70(_0xc34e0d,_0x26faa1){const _0x1c52cb=voti_53_0x1c52();return voti_53_0x3a70=function(_0x3a70d6,_0x1c2d57){_0x3a70d6=_0x3a70d6-0xf7;let _0xf4aab=_0x1c52cb[_0x3a70d6];return _0xf4aab;},voti_53_0x3a70(_0xc34e0d,_0x26faa1);}function voti_53_0x1c52(){const _0x4c9f9e=['ufGrampo','costs','Nenhum\x20modelo\x20configurado\x20com\x20itens\x20para\x20calcular.','\x20modelos\x20calculados\x20com\x20sucesso.','getElementById','2370702JXwQas','telas','clamp','message','calcularCustoChapas','1241150LxagDw','getTemplatesWithPricingStatus','pricing-template-panel[data-template-id-for-query=\x22','getServicesForTemplate','4351144opzpOR','tipoConfiguracao','templateId','getById','pricing-accordion-component','Serviços\x20de\x20Chapas','quantidade','total','Galvanização','store','galvanizacao','\x20modelos\x20calculados\x20(','grampo','templateController','ufDestino','notifications','forEach','WARNING','maoObra','materialPuro','5tYstPD','naoContribuinte','buildConsolidatedByTemplate','81897TtAsen','ufConsumidorFinal','pricingConfig','priceController','getCommercialData','9234599qIZhvO','push','pesoComMargem','budgetController','647950CxxZrT','validateIPIRules','Modelo\x20sem\x20itens\x20no\x20orçamento','querySelector','totalServico','\x20erro(s))','servicoChapas','Mão\x20de\x20Obra','values','nome','ufNaoContribuinte','filter','getUFConfigurationForTemplate','updateTemplatePricingResult','DANGER','getProcessPrices','calculatePrice','templateType','error','ufTelas','updateTemplatePricingConfig','Erro\x20ao\x20calcular\x20pricing\x20para\x20','SUCCESS','94XVuHIb','Modelo\x20não\x20encontrado','revendaNormal','Materiais\x20-\x20','consumidorFinal','hasItems','ufGrade','maoDeObra','reduce','ufRevendaNormal','length','_extractFormData','13377ZYRQAK','show','calculateTemplatePricing','calculateCostsForTemplate','5640uxlOQW','getBudgetItems','9LXJfnZ','preparePricingDataForTemplate','valid'];voti_53_0x1c52=function(){return _0x4c9f9e;};return voti_53_0x1c52();}const voti_53_0x512f1e=voti_53_0x3a70;(function(_0xf36cbf,_0x46b9c7){const _0x365093=voti_53_0x3a70,_0x4354b0=_0xf36cbf();while(!![]){try{const _0x3b37aa=-parseInt(_0x365093(0x14d))/0x1+-parseInt(_0x365093(0x10a))/0x2*(parseInt(_0x365093(0x144))/0x3)+parseInt(_0x365093(0x12d))/0x4+parseInt(_0x365093(0x141))/0x5*(-parseInt(_0x365093(0x124))/0x6)+-parseInt(_0x365093(0x116))/0x7*(-parseInt(_0x365093(0x11a))/0x8)+-parseInt(_0x365093(0x11c))/0x9*(parseInt(_0x365093(0x129))/0xa)+parseInt(_0x365093(0x149))/0xb;if(_0x3b37aa===_0x46b9c7)break;else _0x4354b0['push'](_0x4354b0['shift']());}catch(_0x9542f1){_0x4354b0['push'](_0x4354b0['shift']());}}}(voti_53_0x1c52,0xc93fb));import{CalculationEngine}from'./CalculationEngine.js';import{NOTIFICATION_TYPES}from'../shared/config.js';import{FormattingService}from'../core/services/FormattingService.js';import{CalculationService,separarMateriais}from'../core/services/CalculationService.js';import{CostCalculationService}from'../core/services/CostCalculationService.js';export class PricingController{constructor(_0x1d3b69,_0x1a8f59,_0x3501de,_0x47ead5,_0x46e762){const _0x2a30f3=voti_53_0x3a70;this[_0x2a30f3(0x136)]=_0x1d3b69,this['templateController']=_0x1a8f59,this['budgetController']=_0x3501de,this[_0x2a30f3(0x147)]=_0x47ead5,this['notifications']=_0x46e762;}async[voti_53_0x512f1e(0x118)](_0x3c5f96,_0x340661){const _0x5a3653=voti_53_0x512f1e;try{const _0x14c58c=this[_0x5a3653(0x13a)]['getById'](_0x3c5f96);if(!_0x14c58c)throw new Error(_0x5a3653(0x10b));const _0x225f9e=this['store'][_0x5a3653(0x148)]();if(!_0x340661[_0x5a3653(0x12e)]||!_0x225f9e[_0x5a3653(0x13b)])return this[_0x5a3653(0x13c)][_0x5a3653(0x117)]('Configure\x20o\x20tipo\x20de\x20operação\x20e\x20a\x20UF\x20de\x20destino\x20(na\x20aba\x20Proposta)',NOTIFICATION_TYPES['WARNING']),![];const _0x969fc9=CalculationEngine[_0x5a3653(0x14e)](_0x340661);if(!_0x969fc9[_0x5a3653(0x11e)])return this[_0x5a3653(0x13c)][_0x5a3653(0x117)](_0x969fc9[_0x5a3653(0x105)],NOTIFICATION_TYPES[_0x5a3653(0x101)]),![];this[_0x5a3653(0x136)]['updateTemplatePricingConfig'](_0x3c5f96,_0x340661);const _0x957750=this[_0x5a3653(0x11d)](_0x3c5f96),_0x2abc6c=CalculationEngine['calculatePrice'](_0x957750);return this[_0x5a3653(0x136)][_0x5a3653(0x100)](_0x3c5f96,_0x2abc6c),this[_0x5a3653(0x13c)]['show']('Preço\x20calculado\x20para\x20'+_0x14c58c[_0x5a3653(0xfc)],NOTIFICATION_TYPES[_0x5a3653(0x109)]),!![];}catch(_0x43522f){return this[_0x5a3653(0x13c)][_0x5a3653(0x117)](_0x43522f[_0x5a3653(0x127)]||'Erro\x20no\x20cálculo.\x20Verifique\x20os\x20dados.',NOTIFICATION_TYPES[_0x5a3653(0x101)]),![];}}async['calculateAllTemplatesPricing'](){const _0x55d585=voti_53_0x512f1e,_0x1b69d2=document[_0x55d585(0x123)](_0x55d585(0x131));this[_0x55d585(0x136)][_0x55d585(0x12a)]()[_0x55d585(0xfe)](_0xca30de=>_0xca30de[_0x55d585(0x10f)])[_0x55d585(0x13d)](_0x363b16=>{const _0x21fa72=_0x55d585,_0x408cfb=_0x1b69d2['shadowRoot'][_0x21fa72(0x150)](_0x21fa72(0x12b)+_0x363b16['id']+'\x22]');if(_0x408cfb){const _0x3a6f03=_0x408cfb[_0x21fa72(0x115)]();_0x3a6f03&&this[_0x21fa72(0x136)][_0x21fa72(0x107)](_0x363b16['id'],_0x3a6f03);}});const _0x5b6446=this['store'][_0x55d585(0x12a)]()['filter'](_0x29ca4a=>_0x29ca4a[_0x55d585(0x10f)]&&_0x29ca4a[_0x55d585(0x146)]?.[_0x55d585(0x12e)]);if(_0x5b6446[_0x55d585(0x114)]===0x0)return this[_0x55d585(0x13c)]['show'](_0x55d585(0x121),NOTIFICATION_TYPES[_0x55d585(0x13e)]),0x0;let _0x4d7201=0x0,_0x1a8d67=0x0;for(const _0xf82c90 of _0x5b6446){try{const _0x22db79=this[_0x55d585(0x11d)](_0xf82c90['id']),_0x467f15=CalculationEngine[_0x55d585(0x103)](_0x22db79);this['store'][_0x55d585(0x100)](_0xf82c90['id'],_0x467f15),_0x4d7201++;}catch(_0x3483e0){console[_0x55d585(0x105)](_0x55d585(0x108)+_0xf82c90[_0x55d585(0xfc)]+':',_0x3483e0),_0x1a8d67++;}}const _0x26015c=_0x1a8d67>0x0?_0x4d7201+'/'+_0x5b6446[_0x55d585(0x114)]+_0x55d585(0x138)+_0x1a8d67+_0x55d585(0xf8):_0x4d7201+'/'+_0x5b6446[_0x55d585(0x114)]+_0x55d585(0x122);return this[_0x55d585(0x13c)][_0x55d585(0x117)](_0x26015c,_0x1a8d67>0x0?NOTIFICATION_TYPES['WARNING']:NOTIFICATION_TYPES[_0x55d585(0x109)]),_0x4d7201;}['preparePricingDataForTemplate'](_0x1d704b){const _0x8b413f=voti_53_0x512f1e,_0x267d59=this['templateController'][_0x8b413f(0x130)](_0x1d704b),_0x32d2d4=_0x267d59[_0x8b413f(0x146)]||{},_0x5927e8=this[_0x8b413f(0x136)]['getCommercialData'](),_0x20e69d=this[_0x8b413f(0x136)][_0x8b413f(0x11b)]()[_0x8b413f(0xfe)](_0x97ba2e=>_0x97ba2e[_0x8b413f(0x12f)]===_0x1d704b);if(_0x20e69d['length']===0x0)throw new Error(_0x8b413f(0x14f));const _0x4df47c={..._0x32d2d4,'ufDestino':_0x5927e8[_0x8b413f(0x13b)]},_0x44cd96=this['calculateCostsForTemplate'](_0x267d59,_0x20e69d),_0x158c88=this[_0x8b413f(0xff)](_0x4df47c);let _0x3dea3c;if(_0x267d59['templateType']===_0x8b413f(0x126)){const _0x4f6318=_0x20e69d[_0x8b413f(0x112)]((_0x3d851c,_0x1a2442)=>_0x3d851c+_0x1a2442['quantidade'],0x0),_0x545131=_0x4f6318>0x0?_0x44cd96['materialPuro']/_0x4f6318:0x0;_0x3dea3c={'desc':_0x8b413f(0x10d)+_0x267d59['nome'],'qty':_0x4f6318,'unit':_0x545131,'total':_0x44cd96[_0x8b413f(0x140)]};}else _0x3dea3c={'desc':_0x8b413f(0x10d)+_0x267d59[_0x8b413f(0xfc)],'qty':0x1,'unit':_0x44cd96[_0x8b413f(0x140)],'total':_0x44cd96[_0x8b413f(0x140)]};return{'materiaisDetalhes':[_0x3dea3c],'servicosDetalhes':this[_0x8b413f(0x12c)](_0x44cd96),..._0x4df47c,..._0x158c88};}[voti_53_0x512f1e(0x119)](_0x338d05,_0x417dcc){const _0x5c8b9f=voti_53_0x512f1e;if(_0x338d05[_0x5c8b9f(0x104)]==='clamp'){const _0x4064ae=_0x417dcc['reduce']((_0x285838,_0x334a10)=>_0x285838+_0x334a10[_0x5c8b9f(0x133)],0x0),_0x4d7c50=Object[_0x5c8b9f(0xfb)](_0x338d05[_0x5c8b9f(0x120)]['material'])[_0x5c8b9f(0x112)]((_0x1a4116,_0x202617)=>_0x1a4116+_0x202617,0x0),_0x195304=Object['values'](_0x338d05[_0x5c8b9f(0x120)][_0x5c8b9f(0x111)])[_0x5c8b9f(0x112)]((_0x3c7516,_0x3b21c9)=>_0x3c7516+_0x3b21c9,0x0),_0x25ce84=Object[_0x5c8b9f(0xfb)](_0x338d05[_0x5c8b9f(0x120)][_0x5c8b9f(0x137)])[_0x5c8b9f(0x112)]((_0x1f4b29,_0x1e8c59)=>_0x1f4b29+_0x1e8c59,0x0);return{'materialPuro':_0x4d7c50*_0x4064ae,'maoObra':_0x195304*_0x4064ae,'galvanizacao':_0x25ce84*_0x4064ae,'servicoChapas':0x0};}const _0x1cbc8e=[_0x338d05],_0x209ef6=this[_0x5c8b9f(0x14c)][_0x5c8b9f(0x143)](_0x1cbc8e,this[_0x5c8b9f(0x147)]),_0x5c1721=this[_0x5c8b9f(0x14c)]['buildConsolidatedChapas'](_0x1cbc8e,this[_0x5c8b9f(0x147)]),_0x1dcabe=CostCalculationService['calcularCustoMaterialConsolidado'](_0x209ef6,this[_0x5c8b9f(0x147)],_0x1cbc8e),_0x57bd3c=CostCalculationService[_0x5c8b9f(0x128)](_0x5c1721,this[_0x5c8b9f(0x147)],_0x1cbc8e);let _0x48b466=0x0,_0x52ddb2=0x0,_0x157f8d=_0x57bd3c[_0x5c8b9f(0xf7)];return _0x417dcc[_0x5c8b9f(0x13d)](_0x467e23=>{const _0x43616d=_0x5c8b9f,_0x1c4823=CalculationService['calcular'](_0x467e23,_0x338d05,this[_0x43616d(0x147)]),_0x1c1fbe=this[_0x43616d(0x147)][_0x43616d(0x102)](_0x338d05);_0x48b466+=_0x1c4823[_0x43616d(0x14b)]*_0x1c1fbe['maoObra'],_0x52ddb2+=_0x1c4823[_0x43616d(0x14b)]*_0x1c1fbe[_0x43616d(0x137)];}),{'materialPuro':_0x1dcabe[_0x5c8b9f(0x134)]+_0x57bd3c['totalMaterial'],'maoObra':_0x48b466,'galvanizacao':_0x52ddb2,'servicoChapas':_0x157f8d};}['getServicesForTemplate'](_0x3d3a2e){const _0x2dd1c1=voti_53_0x512f1e,_0x5f571c=[];if(_0x3d3a2e['maoObra']>0x0)_0x5f571c[_0x2dd1c1(0x14a)]({'desc':_0x2dd1c1(0xfa),'qty':0x1,'unit':_0x3d3a2e[_0x2dd1c1(0x13f)],'total':_0x3d3a2e[_0x2dd1c1(0x13f)]});if(_0x3d3a2e[_0x2dd1c1(0x137)]>0x0)_0x5f571c[_0x2dd1c1(0x14a)]({'desc':_0x2dd1c1(0x135),'qty':0x1,'unit':_0x3d3a2e['galvanizacao'],'total':_0x3d3a2e['galvanizacao']});if(_0x3d3a2e['servicoChapas']>0x0)_0x5f571c[_0x2dd1c1(0x14a)]({'desc':_0x2dd1c1(0x132),'qty':0x1,'unit':_0x3d3a2e[_0x2dd1c1(0xf9)],'total':_0x3d3a2e['servicoChapas']});return _0x5f571c;}[voti_53_0x512f1e(0xff)](_0x4f9325){const _0x35a1da=voti_53_0x512f1e,_0xd7cfc8={'ufGrade':'','ufGrampo':'','ufTelas':'','ufNaoContribuinte':'','ufConsumidorFinal':'','ufRevendaNormal':''};if(_0x4f9325[_0x35a1da(0x12e)]&&_0x4f9325[_0x35a1da(0x13b)])switch(_0x4f9325['tipoConfiguracao']){case'grade':_0xd7cfc8[_0x35a1da(0x110)]=_0x4f9325[_0x35a1da(0x13b)];break;case _0x35a1da(0x139):_0xd7cfc8[_0x35a1da(0x11f)]=_0x4f9325[_0x35a1da(0x13b)];break;case _0x35a1da(0x125):_0xd7cfc8[_0x35a1da(0x106)]=_0x4f9325['ufDestino'];break;case _0x35a1da(0x142):_0xd7cfc8[_0x35a1da(0xfd)]=_0x4f9325[_0x35a1da(0x13b)];break;case _0x35a1da(0x10e):_0xd7cfc8[_0x35a1da(0x145)]=_0x4f9325[_0x35a1da(0x13b)];break;case _0x35a1da(0x10c):_0xd7cfc8[_0x35a1da(0x113)]=_0x4f9325[_0x35a1da(0x13b)];break;}return _0xd7cfc8;}}